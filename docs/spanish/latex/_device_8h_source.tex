\doxysection{Device.\+h}
\hypertarget{_device_8h_source}{}\label{_device_8h_source}\index{include/Device.h@{include/Device.h}}
\mbox{\hyperlink{_device_8h}{Ir a la documentaci√≥n de este archivo.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00001}00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00002}00002\ \textcolor{preprocessor}{\#include\ <vulkan/vulkan.h>}}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00003}00003\ \textcolor{preprocessor}{\#include\ <GLFW/glfw3.h>}}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00004}00004\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00005}00005\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00006}00006\ \textcolor{preprocessor}{\#include\ <nvvk/resourceallocator\_vk.hpp>}}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00007}00007\ \textcolor{preprocessor}{\#include\ <nvvk/debug\_util\_vk.hpp>}}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00008}00008\ \textcolor{preprocessor}{\#include\ <nvvk/raytraceKHR\_vk.hpp>}}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00009}00009\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{_mesh_8h}{Mesh.h}}>}}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00010}00010\ \textcolor{preprocessor}{\#include\ <nvvk/context\_vk.hpp>}}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00011}00011\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{_command_list_8h}{CommandList.h}}>}}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00012}00012\ }
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00013}00013\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespace_astra}{Astra}}}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00014}00014\ \{}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00015}00015\ }
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00029}\mbox{\hyperlink{struct_astra_1_1_device_create_info}{00029}}\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_astra_1_1_device_create_info}{DeviceCreateInfo}}}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00030}00030\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00031}\mbox{\hyperlink{struct_astra_1_1_device_create_info_a9a9482204d9f3ec2281f33b1438724b5}{00031}}\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{struct_astra_1_1_device_create_info_a9a9482204d9f3ec2281f33b1438724b5}{debug}}\{\textcolor{keyword}{true}\};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00032}\mbox{\hyperlink{struct_astra_1_1_device_create_info_a678d449aab55a7a790494c8354b6bc89}{00032}}\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{struct_astra_1_1_device_create_info_a678d449aab55a7a790494c8354b6bc89}{useRT}}\{\textcolor{keyword}{true}\};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00033}00033\ }
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00034}\mbox{\hyperlink{struct_astra_1_1_device_create_info_a62e9a1422c8d57c914ae4656fd50afac}{00034}}\ \ \ \ \ \ \ \ \ std::vector<std::string>\ \mbox{\hyperlink{struct_astra_1_1_device_create_info_a62e9a1422c8d57c914ae4656fd50afac}{instanceLayers}};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00035}\mbox{\hyperlink{struct_astra_1_1_device_create_info_ad72c75f71da8ffc26af01b68102db729}{00035}}\ \ \ \ \ \ \ \ \ std::vector<std::string>\ \mbox{\hyperlink{struct_astra_1_1_device_create_info_ad72c75f71da8ffc26af01b68102db729}{instanceExtensions}};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00036}\mbox{\hyperlink{struct_astra_1_1_device_create_info_a08d13ec6b6f9fbd4bb3651e3c494ea5d}{00036}}\ \ \ \ \ \ \ \ \ std::vector<std::string>\ \mbox{\hyperlink{struct_astra_1_1_device_create_info_a08d13ec6b6f9fbd4bb3651e3c494ea5d}{deviceExtensions}};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00037}\mbox{\hyperlink{struct_astra_1_1_device_create_info_a50048b4336662448fd6a80d3e54731ac}{00037}}\ \ \ \ \ \ \ \ \ uint32\_t\ \mbox{\hyperlink{struct_astra_1_1_device_create_info_a50048b4336662448fd6a80d3e54731ac}{vkVersionMajor}}\{1\};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00038}\mbox{\hyperlink{struct_astra_1_1_device_create_info_a36f1bbc57d9e904ca2586990e03e2f15}{00038}}\ \ \ \ \ \ \ \ \ uint32\_t\ \mbox{\hyperlink{struct_astra_1_1_device_create_info_a36f1bbc57d9e904ca2586990e03e2f15}{vkVersionMinor}}\{3\};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00039}00039\ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00045}\mbox{\hyperlink{class_astra_1_1_device}{00045}}\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_astra_1_1_device}{Device}}}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00046}00046\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00047}00047\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00048}00048\ \ \ \ \ \ \ \ \ VkInstance\ \_instance;}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00049}00049\ \ \ \ \ \ \ \ \ VkDevice\ \_vkdevice;}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00050}00050\ \ \ \ \ \ \ \ \ VkSurfaceKHR\ \_surface;}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00051}00051\ \ \ \ \ \ \ \ \ GLFWwindow\ *\_window;}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00052}00052\ \ \ \ \ \ \ \ \ VkPhysicalDevice\ \_physicalDevice;}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00053}00053\ \ \ \ \ \ \ \ \ VkQueue\ \_queue;}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00054}00054\ \ \ \ \ \ \ \ \ uint32\_t\ \_graphicsQueueIndex;}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00055}00055\ \ \ \ \ \ \ \ \ VkCommandPool\ \_cmdPool;}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00056}00056\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \_raytracingEnabled;}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00057}00057\ }
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00058}00058\ \ \ \ \ \ \ \ \ nvvk::DebugUtil\ \_debug;}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00059}00059\ \ \ \ \ \ \ \ \ nvvk::Context\ \_vkcontext\{\};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00060}00060\ }
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00061}00061\ \ \ \ \ \ \ \ \ VkPhysicalDeviceRayTracingPipelinePropertiesKHR\ \_rtProperties\{VK\_STRUCTURE\_TYPE\_PHYSICAL\_DEVICE\_RAY\_TRACING\_PIPELINE\_PROPERTIES\_KHR\};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00062}00062\ }
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00063}00063\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_astra_1_1_device}{Device}}()\ \{\}}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00064}00064\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_astra_1_1_device}{\string~Device}}()}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00065}00065\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00066}00066\ \ \ \ \ \ \ \ \ \ \ \ \ glfwDestroyWindow(\_window);}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00067}00067\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00068}00068\ }
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00069}00069\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00070}\mbox{\hyperlink{class_astra_1_1_device_ab627de02c6fe713f9b97021aeeccd49a}{00070}}\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{class_astra_1_1_device}{Device}}\ \&\mbox{\hyperlink{class_astra_1_1_device_ab627de02c6fe713f9b97021aeeccd49a}{getInstance}}()}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00071}00071\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00072}00072\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{class_astra_1_1_device}{Device}}\ instance;}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00073}00073\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ instance;}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00074}00074\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00075}00075\ }
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00076}\mbox{\hyperlink{class_astra_1_1_device_ac3c3c8cf138ccf5fff6bb01db510c7a7}{00076}}\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_astra_1_1_device_ac3c3c8cf138ccf5fff6bb01db510c7a7}{Device}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_astra_1_1_device}{Device}}\ \&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00077}\mbox{\hyperlink{class_astra_1_1_device_a3dcf4735ba489ce66ace160d424dbc0b}{00077}}\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_astra_1_1_device}{Device}}\ \&\mbox{\hyperlink{class_astra_1_1_device_a3dcf4735ba489ce66ace160d424dbc0b}{operator=}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_astra_1_1_device}{Device}}\ \&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00082}00082\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_astra_1_1_device_a007fe12254cf51694e6b4411e473d011}{initDevice}}(\mbox{\hyperlink{struct_astra_1_1_device_create_info}{DeviceCreateInfo}}\ createInfo);}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00083}00083\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_astra_1_1_device_a9dbcbbf7a7c6f89d1c4ebbcfc330056c}{destroy}}();}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00084}00084\ }
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00085}00085\ \ \ \ \ \ \ \ \ VkInstance\ \mbox{\hyperlink{class_astra_1_1_device_a0713844ec752b16682dd1e998cb41665}{getVkInstance}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00086}00086\ \ \ \ \ \ \ \ \ VkDevice\ \mbox{\hyperlink{class_astra_1_1_device_a0b9ac79f70409c1d1b67d1f07755c063}{getVkDevice}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00087}00087\ \ \ \ \ \ \ \ \ VkSurfaceKHR\ \mbox{\hyperlink{class_astra_1_1_device_af5c626dc299d25c9f3d4146e3631169b}{getSurface}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00088}00088\ \ \ \ \ \ \ \ \ VkPhysicalDevice\ \mbox{\hyperlink{class_astra_1_1_device_abdf261fdebb47beb6039ee235201cc3a}{getPhysicalDevice}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00089}00089\ \ \ \ \ \ \ \ \ VkQueue\ \mbox{\hyperlink{class_astra_1_1_device_a8194188ccf5666af8753c436dc6ac82c}{getQueue}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00090}00090\ \ \ \ \ \ \ \ \ uint32\_t\ \mbox{\hyperlink{class_astra_1_1_device_a0c726b52378b4cfacd6499a82efa9122}{getGraphicsQueueIndex}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00091}00091\ \ \ \ \ \ \ \ \ VkCommandPool\ \mbox{\hyperlink{class_astra_1_1_device_a4ce513cf894df48fdfc35c5fdcd59417}{getCommandPool}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00092}00092\ \ \ \ \ \ \ \ \ GLFWwindow\ *\mbox{\hyperlink{class_astra_1_1_device_ac2d65f4bb7b62874f42a0f31cbb7a00c}{getWindow}}();}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00093}00093\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_astra_1_1_device_aee8364a323f25c81b9a2973d48062eb4}{getRtEnabled}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00094}00094\ \ \ \ \ \ \ \ \ VkPhysicalDeviceRayTracingPipelinePropertiesKHR\ \mbox{\hyperlink{class_astra_1_1_device_aa92d2a1cbb4a072903c28baad5de2662}{getRtProperties}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00095}00095\ }
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00100}00100\ \ \ \ \ \ \ \ \ VkShaderModule\ \mbox{\hyperlink{class_astra_1_1_device_af7e7dd56ffdf14b4aefbf877d6269f29}{createShaderModule}}(\textcolor{keyword}{const}\ std::vector<char>\ \&file);}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00101}00101\ \ \ \ \ \ \ \ \ VkShaderModule\ \mbox{\hyperlink{class_astra_1_1_device_af7e7dd56ffdf14b4aefbf877d6269f29}{createShaderModule}}(\textcolor{keyword}{const}\ std::string\ \&file);}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00106}00106\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_astra_1_1_device_ab3f885fd6f508484e0657a9f5eeb228c}{createTextureImages}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_astra_1_1_command_list}{Astra::CommandList}}\ \&cmdList,\ \textcolor{keyword}{const}\ std::vector<std::string>\ \&new\_textures,\ std::vector<nvvk::Texture>\ \&textures,\ nvvk::ResourceAllocatorDma\ \&alloc);}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00111}00111\ \ \ \ \ \ \ \ \ nvvk::RaytracingBuilderKHR::BlasInput\ \mbox{\hyperlink{class_astra_1_1_device_ab8e4c133075fafd3cda16b55cb84a180}{objectToVkGeometry}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{struct_astra_1_1_mesh}{Astra::Mesh}}\ \&model);}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00112}00112\ }
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00119}00119\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00120}00120\ \ \ \ \ \ \ \ \ nvvk::Buffer\ \mbox{\hyperlink{class_astra_1_1_device_ad22b5336ac7e33c9327f26778fb788b1}{createUBO}}(nvvk::ResourceAllocator\ *alloc);}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00125}00125\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00126}00126\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_astra_1_1_device_ae0d8d8e6f9ed5074cd19c1a26863f64d}{updateUBO}}(T\ hostUBO,\ nvvk::Buffer\ \&deviceBuffer,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_astra_1_1_command_list}{CommandList}}\ \&cmdList);}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00127}00127\ }
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00128}00128\ \ \ \ \ \ \ \ \ uint32\_t\ \mbox{\hyperlink{class_astra_1_1_device_a0df50f9800ee6760f9ea5cfd713bb3ba}{getMemoryType}}(uint32\_t\ typeBits,\ \textcolor{keyword}{const}\ VkMemoryPropertyFlags\ \&properties)\ \textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00129}00129\ \ \ \ \ \ \ \ \ std::array<int,\ 2>\ \mbox{\hyperlink{class_astra_1_1_device_a78dfbb7faefb82b8056c23dd3e030dc7}{getWindowSize}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00130}00130\ }
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00135}00135\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_astra_1_1_device_a751d7a676133b517d885be134f84f989}{waitIdle}}();}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00140}00140\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_astra_1_1_device_a92120095aca2d9d324e5f2ee298314e2}{queueWaitIdle}}();}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00141}00141\ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00142}00142\ }
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00143}\mbox{\hyperlink{_device_8h_a2fba0ef1853e57846ae6bc3a5d30db39}{00143}}\ \textcolor{preprocessor}{\#define\ AstraDevice\ Astra::Device::getInstance()}}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00144}00144\ }
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00145}00145\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00146}\mbox{\hyperlink{class_astra_1_1_device_ad22b5336ac7e33c9327f26778fb788b1}{00146}}\ \ \ \ \ \textcolor{keyword}{inline}\ nvvk::Buffer\ \mbox{\hyperlink{class_astra_1_1_device_ad22b5336ac7e33c9327f26778fb788b1}{Device::createUBO}}(nvvk::ResourceAllocator\ *alloc)}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00147}00147\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00148}00148\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ alloc-\/>createBuffer(\textcolor{keyword}{sizeof}(T),\ VK\_BUFFER\_USAGE\_UNIFORM\_BUFFER\_BIT\ |\ VK\_BUFFER\_USAGE\_TRANSFER\_DST\_BIT,}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00149}00149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ VK\_MEMORY\_PROPERTY\_DEVICE\_LOCAL\_BIT);}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00150}00150\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00151}00151\ }
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00152}00152\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00153}\mbox{\hyperlink{class_astra_1_1_device_ae0d8d8e6f9ed5074cd19c1a26863f64d}{00153}}\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_astra_1_1_device_ae0d8d8e6f9ed5074cd19c1a26863f64d}{Device::updateUBO}}(T\ hostUBO,\ nvvk::Buffer\ \&deviceBuffer,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_astra_1_1_command_list}{CommandList}}\ \&cmdList)}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00154}00154\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00155}00155\ }
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00156}00156\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ UBO\ on\ the\ device,\ and\ what\ stages\ access\ it.}}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00157}00157\ \ \ \ \ \ \ \ \ VkBuffer\ deviceUBO\ =\ deviceBuffer.buffer;}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00158}00158\ \ \ \ \ \ \ \ \ uint32\_t\ uboUsageStages\ =\ VK\_PIPELINE\_STAGE\_VERTEX\_SHADER\_BIT;}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00159}00159\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{class_astra_1_1_device_aee8364a323f25c81b9a2973d48062eb4}{getRtEnabled}}())}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00160}00160\ \ \ \ \ \ \ \ \ \ \ \ \ uboUsageStages\ =\ uboUsageStages\ |\ VK\_PIPELINE\_STAGE\_RAY\_TRACING\_SHADER\_BIT\_KHR;}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00161}00161\ }
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00162}00162\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Ensure\ that\ the\ modified\ UBO\ is\ not\ visible\ to\ previous\ frames.}}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00163}00163\ \ \ \ \ \ \ \ \ VkBufferMemoryBarrier\ beforeBarrier\{VK\_STRUCTURE\_TYPE\_BUFFER\_MEMORY\_BARRIER\};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00164}00164\ \ \ \ \ \ \ \ \ beforeBarrier.srcAccessMask\ =\ VK\_ACCESS\_SHADER\_READ\_BIT;}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00165}00165\ \ \ \ \ \ \ \ \ beforeBarrier.dstAccessMask\ =\ VK\_ACCESS\_TRANSFER\_WRITE\_BIT;}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00166}00166\ \ \ \ \ \ \ \ \ beforeBarrier.buffer\ =\ deviceUBO;}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00167}00167\ \ \ \ \ \ \ \ \ beforeBarrier.offset\ =\ 0;}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00168}00168\ \ \ \ \ \ \ \ \ beforeBarrier.size\ =\ \textcolor{keyword}{sizeof}(hostUBO);}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00169}00169\ \ \ \ \ \ \ \ \ cmdList.\mbox{\hyperlink{class_astra_1_1_command_list_ab9130a40f8aea7a94f860bbeb35ad326}{pipelineBarrier}}(uboUsageStages,\ VK\_PIPELINE\_STAGE\_TRANSFER\_BIT,\ VK\_DEPENDENCY\_DEVICE\_GROUP\_BIT,\ \{\},\ \{beforeBarrier\},\ \{\});}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00170}00170\ }
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00171}00171\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Schedule\ the\ host-\/to-\/device\ upload.\ (hostUBO\ is\ copied\ into\ the\ cmd}}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00172}00172\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ buffer\ so\ it\ is\ okay\ to\ deallocate\ when\ the\ function\ returns).}}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00173}00173\ \ \ \ \ \ \ \ \ cmdList.\mbox{\hyperlink{class_astra_1_1_command_list_a9eaadde1213e7fef6f7c2f72a50f3f91}{updateBuffer}}(deviceBuffer,\ 0,\ \textcolor{keyword}{sizeof}(T),\ \&hostUBO);}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00174}00174\ }
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00175}00175\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Making\ sure\ the\ updated\ UBO\ will\ be\ visible.}}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00176}00176\ \ \ \ \ \ \ \ \ VkBufferMemoryBarrier\ afterBarrier\{VK\_STRUCTURE\_TYPE\_BUFFER\_MEMORY\_BARRIER\};}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00177}00177\ \ \ \ \ \ \ \ \ afterBarrier.srcAccessMask\ =\ VK\_ACCESS\_TRANSFER\_WRITE\_BIT;}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00178}00178\ \ \ \ \ \ \ \ \ afterBarrier.dstAccessMask\ =\ VK\_ACCESS\_SHADER\_READ\_BIT;}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00179}00179\ \ \ \ \ \ \ \ \ afterBarrier.buffer\ =\ deviceUBO;}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00180}00180\ \ \ \ \ \ \ \ \ afterBarrier.offset\ =\ 0;}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00181}00181\ \ \ \ \ \ \ \ \ afterBarrier.size\ =\ \textcolor{keyword}{sizeof}(hostUBO);}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00182}00182\ \ \ \ \ \ \ \ \ cmdList.\mbox{\hyperlink{class_astra_1_1_command_list_ab9130a40f8aea7a94f860bbeb35ad326}{pipelineBarrier}}(VK\_PIPELINE\_STAGE\_TRANSFER\_BIT,\ uboUsageStages,\ VK\_DEPENDENCY\_DEVICE\_GROUP\_BIT,\ \{\},\ \{afterBarrier\},\ \{\});}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00183}00183\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_device_8h_source_l00184}00184\ \}}

\end{DoxyCode}
